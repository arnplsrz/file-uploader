<% if (locals.user) { %>
<%- include('../partials/aside', { folder: folder }) %>

<h2>Uploaded Images</h2>
<div class="image-grid">
  <% if (files && files.length > 0) { %>
  <% files.forEach(file => { %>
  <% if (file.type.startsWith('image/')) { %>
  <div class="image-item">
    <img src="<%= file.path %>" alt="<%= file.name %>" style="max-width: 300px">
    <p><%= file.name %></p>
  </div>
  <% } %>
  <% }) %>
  <% } else { %>
  <p>No files available.</p>
  <% } %>
</div>

<h2>Subfolders</h2>
<ul>
  <% if (folders && folders.length > 0) { %>
  <% folders.forEach(folder => { %>
  <li>
    <span><a href="/folder/<%= folder.id %>"><%= folder.name %></a></span>
    <button class="folder-options-btn" onclick="toggleOptions('<%= folder.id %>')">Options</button>
    <div id="options-<%= folder.id %>" class="folder-options" style="display: none;">
      <form action="/folder/<%= folder.id %>/rename" method="post">
        <input type="text" name="newName" placeholder="Rename folder" required>
        <button type="submit">Rename</button>
      </form>
      <form action="/folder/<%= folder.id %>/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this folder?');">
        <button type="submit">Delete</button>
      </form>
    </div>
  </li>
  <% }) %>
  <% } else { %>
  <li>No subfolders available.</li>
  <% } %>
</ul>

<script>
  function toggleOptions(folderId) {
    const optionsDiv = document.getElementById(`options-${folderId}`);
    optionsDiv.style.display = optionsDiv.style.display === 'none' ? 'block' : 'none';
  }
</script>
<% } %>