<% if (locals.user) { %>
<body class="flex flex-1 bg-neutral-50 dark:bg-neutral-900">
  <%- include('../partials/aside', { folder: folder }) %>
  <%- include("../partials/error", { message: message }) %>
  <main class="flex-1 m-0 sm:m-4 sm:rounded-lg bg-white dark:bg-neutral-950 text-neutral-950 dark:text-neutral-50 space-y-4 shadow-sm [&_h2]:px-6 [&_ul]:px-6">

    <header class="space-y-4 pt-6 px-6 *:flex *:justify-between">
      <section class="items-center space-x-4">
        <!-- MARK: Sidebar trigger -->
        <div class="block lg:hidden" x-data="{ openSidebar: false }">
          <button
            class="dark:text-white cursor-pointer"
            x-on:click="openSidebar = !openSidebar"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
          </button>

          <div
            class="fixed inset-0 z-50 bg-neutral-50 dark:bg-neutral-900 dark:text-white border-r border-r-neutral-200 dark:border-r-neutral-600 p-4 w-64 h-full md:flex flex-col"
            x-show="openSidebar"
            x-cloak
            x-on:click.outside="openSidebar = false"
            x-on:keydown.escape.prevent.stop="openSidebar = false"
            x-transition:enter="transition ease-in-out duration-300 transform"
            x-transition:enter-start="-translate-x-full"
            x-transition:enter-end="translate-x-0"
            x-transition:leave="transition ease-in-out duration-300 transform"
            x-transition:leave-start="translate-x-0"
            x-transition:leave-end="-translate-x-full"
          >
          <header class="mb-4 flex items-center justify-between">
            <div class="flex items-center gap-2">
              <img src="/favicon-32x32.png" alt="" />
              <a href="/" class="mt-1 text-base font-medium">File Uploader</a>
            </div>
            <div class="flex gap-2 text-neutral-800 transition-colors dark:text-white">
              <button
                class="cursor-pointer hover:text-neutral-900/75 dark:hover:text-white/75"
                id="themeToggleButton"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  height="24px"
                  viewBox="0 -960 960 960"
                  width="24px"
                  fill="currentColor"
                >
                  <path
                    d="M396-396q-32-32-58.5-67T289-537q-5 14-6.5 28.5T281-480q0 83 58 141t141 58q14 0 28.5-2t28.5-6q-39-22-74-48.5T396-396Zm57-56q51 51 114 87.5T702-308q-40 51-98 79.5T481-200q-117 0-198.5-81.5T201-480q0-65 28.5-123t79.5-98q20 72 56.5 135T453-452Zm290 72q-20-5-39.5-11T665-405q8-18 11.5-36.5T680-480q0-83-58.5-141.5T480-680q-20 0-38.5 3.5T405-665q-8-19-13.5-38T381-742q24-9 49-13.5t51-4.5q117 0 198.5 81.5T761-480q0 26-4.5 51T743-380ZM440-840v-120h80v120h-80Zm0 840v-120h80V0h-80Zm323-706-57-57 85-84 57 56-85 85ZM169-113l-57-56 85-85 57 57-85 84Zm671-327v-80h120v80H840ZM0-440v-80h120v80H0Zm791 328-85-85 57-57 84 85-56 57ZM197-706l-84-85 56-57 85 85-57 57Zm199 310Z"
                  />
                </svg>
              </button>
              <a
                href="https://github.com/arnplsrz/file-uploader"
                target="_blank"
                rel="noopener noreferrer"
                class="ml-auto hover:text-neutral-900/75 dark:hover:text-white/75"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.333-1.754-1.333-1.754-1.09-.745.083-.73.083-.73 1.205.085 1.84 1.236 1.84 1.236 1.07 1.835 2.807 1.305 3.492.997.108-.775.418-1.305.76-1.605-2.665-.3-5.466-1.335-5.466-5.93 0-1.31.47-2.38 1.236-3.22-.124-.303-.536-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.52 11.52 0 013.003-.404c1.02.005 2.045.138 3.003.404 2.29-1.552 3.296-1.23 3.296-1.23.655 1.653.243 2.873.12 3.176.77.84 1.234 1.91 1.234 3.22 0 4.61-2.807 5.625-5.48 5.92.43.37.823 1.1.823 2.22 0 1.606-.015 2.896-.015 3.286 0 .32.216.694.825.576C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12z"
                  />
                </svg>
              </a>
            </div>
          </header>
          </div>
        </div>

        <!-- MARK: Search bar -->
        <div class="relative lg:w-3/5 w-full">
          <form action="/folder/<%= folder.id %>" method="get">
            <input
              type="text"
              name="search"
              id="search"
              placeholder="Search files..."
              class="w-full p-2 pl-10 bg-neutral-200 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 focus-visible:border-neutral-400 dark:focus-visible:border-neutral-600 focus-visible:ring-neutral-300 dark:focus-visible:ring-neutral-700 focus-visible:ring-[3px] rounded outline-none"
              value="<%= query.search %>"
            />
          </form>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"s
            />
          </svg>
          <% if (query.search) { %>
            <a 
              href="/folder/<%= folder.id %>"
              class="cursor-pointer"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 absolute right-3 top-1/2 transform -translate-y-1/2"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="currentColor"
              >
                <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
              </svg>
            </a>
          <% } %>
        </div>

        <!-- MARK: Share button -->
        <% if (root.id != folder.id) { %>
          <div class="mr-0" x-data="{open: false}">
          <!-- MARK: Search button -->
            <button
              class="bg-primary-0 text-neutral-950 font-semibold px-3 py-2 rounded flex items-center space-x-2 cursor-pointer"
              @click="open = !open"
            >
              <span>Share</span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
                />
              </svg>
            </button>

            <!-- MARK: Share form -->
            <div 
              class="absolute inset-0 bg-neutral-950/30 flex items-center justify-center" 
              x-show="open" 
              x-transition.opacity
              x-cloak
            >
              <form 
                action="/folder/<%= folder.id %>/share" 
                method="post" 
                class="p-4 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 shadow-lg rounded-md"
                x-show="open" 
                @click.away="open = false"
                x-transition
              >
                <fieldset>
                  <legend class="text-lg font-semibold mb-2">Share folder</legend>
                  <section class="space-y-2 mb-4 [&_div_input]: accent-primary-30">
                    <div>
                      <input type="radio" id="1 day" name="duration" value="1 day" checked>
                      <label for="1 day" class="ml-2">1 day</label>
                    </div>
                    <div>
                      <input type="radio" id="3 days" name="duration" value="3 days">
                      <label for="3 days" class="ml-2">3 days</label>
                    </div>
                    <div>
                      <input type="radio" id="1 week" name="duration" value="1 week">
                      <label for="1 week" class="ml-2">1 week</label>
                    </div>
                  </section>
                </fieldset>
              <section class="flex">
                <button type="submit" class="border border-neutral-800 text-primary-10 px-4 py-2 flex gap-2 rounded mr-2 cursor-pointer">
                  <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.213 9.787a3.391 3.391 0 0 0-4.795 0l-3.425 3.426a3.39 3.39 0 0 0 4.795 4.794l.321-.304m-.321-4.49a3.39 3.39 0 0 0 4.795 0l3.424-3.426a3.39 3.39 0 0 0-4.794-4.795l-1.028.961"/>
                </svg>
                  Copy link
                </button>
                <button type="button" class="bg-primary-0 text-black px-4 py-2 rounded cursor-pointer" @click="open = false">Done</button>
              </section>
          </form>
            </div>
          </div>
        <% } %>
        
        <!-- MARK: Account dropdown -->
        <div x-data="{ openMenu: false }" class="block lg:hidden relative">
          <button
            @click="openMenu = !openMenu"
            class="w-8 h-8 rounded-full object-cover border border-neutral-200 dark:border-neutral-800 p-1 hover:bg-gray-200 dark:hover:bg-neutral-600 focus:outline-none cursor-pointer"
            aria-label="User menu"
          >
            <img
              src="<%= locals.user.avatar || '/favicon-32x32.png' %>"
              alt="User Avatar"
            />
          </button>
          
          <div
            x-show="openMenu"
            @click.away="openMenu = false"
            x-transition
            class="absolute -left-27 -bottom-14 transform -translate-y-1/2 w-32 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 dark:text-white rounded-sm shadow-lg z-20 [&_a]:block [&_a]:px-4 [&_a]:py-2"
            x-cloak
          >
            <a href="/logout">Logout</a>
          </div>
        </div>
      </section>

      <section class="items-center">
        <!-- MARK: Breadcrumbs -->
        <div>
          <h1 class="mb-1 text-2xl font-semibold tracking-tight text-balance">Welcome! <%= locals.user.username %></h1>
          <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M160-160q-33 0-56.5-23.5T80-240v-480q0-33 23.5-56.5T160-800h240l80 80h320q33 0 56.5 23.5T880-640v400q0 33-23.5 56.5T800-160H160Zm0-80h640v-400H447l-80-80H160v480Zm0 0v-480 480Z"/></svg>
            <% breadcrumbs.forEach((b, index) => { %> <% if (index > 0) { %> /&ThickSpace; <% } %>
            <a href="/folder/<%= b.id %>" class="hover:underline"><%= b.name %></a>
            <% }) %>
            <% if (folder.isShared) { %>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
                  />
                </svg>
              <% } %>
          </div>
        </div>

        <div class="hidden lg:flex items-center gap-2" x-data="{ open: false }">
          <!-- MARK: New folder button -->
          <button
            @click="open = !open"
            class="bg-primary-20 dark:text-black px-3 py-2 rounded flex items-center space-x-2 cursor-pointer"
            title="Create Folder"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              />
            </svg>
            <span>New Folder</span>
          </button>

          <!-- MARK: Upload file button -->
          <button
            @click="$refs.fileInput.click()"
            class="bg-primary-20 dark:text-black px-3 py-2 rounded flex items-center space-x-2 cursor-pointer"
            title="Upload File"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <span>Upload File</span>
          </button>

          <!-- MARK: New folder form -->
          <div
            class="w-screen h-screen bg-neutral-950/30 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex items-center justify-center"
            x-show="open"
            x-cloak
            x-transition.opacity
          >
            <form 
              action="/folder/<%= folder.id %>/create" 
              method="post" 
              x-show="open"
              @click.away="open = false" 
              class="p-4 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded shadow-lg"
            >
              <label for="folderName" class="block text-sm font-medium mb-2">
                Folder Name:
              </label>
              <input
                type="text"
                name="folderName"
                id="folderName"
                class="w-full p-2 mb-4 bg-neutral-200 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 focus-visible:border-neutral-400 dark:focus-visible:border-neutral-600 focus-visible:ring-neutral-300 dark:focus-visible:ring-neutral-700 focus-visible:ring-[3px] rounded outline-none"
                placeholder="Enter folder name"
                required
              />
              <div class="flex justify-end gap-2">
                <button
                  type="button"
                  @click="open = false"
                  class="px-4 py-2 rounded font-semibold text-neutral-700 dark:text-neutral-200 cursor-pointer"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="px-4 py-2 rounded font-semibold cursor-pointer bg-primary-20 dark:text-neutral-900"
                >
                  Create
                </button>
              </div>
            </form>
          </div>
          
          <!-- MARK: Upload folder form -->
          <form
            action="/folder/<%= folder.id %>/upload"
            method="post"
            enctype="multipart/form-data"
            class="hidden"
          >
            <input
              type="file"
              name="file"
              x-ref="fileInput"
              class="hidden"
              @change="$el.form.submit()"
            />
          </form>
        </div>
      </section>
    </header>

    <!-- MARK: Sort buttons -->
    <nav class="flex flex-col text-base">
      <section class="px-6 flex flex-wrap items-center gap-2">
        <a 
          href="/folder/<%= folder.id %>?sort=name&order=<%= query.sort == "name" && query.order == "desc" ? "asc" : "desc" %>" 
          class="px-3 py-2 bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-sm flex items-center gap-2 cursor-pointer"
        >
          Name
          <% if (query.sort == "name" && query.order == "desc") { %>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
              <path d="M480-360 280-560h400L480-360Z"/>
            </svg>
          <% } else { %>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
              <path d="m280-400 200-200 200 200H280Z"/>
            </svg>
          <% } %>
        </a>
        <a 
          href="/folder/<%= folder.id %>?sort=createdAt&order=<%= query.sort == "createdAt" && query.order == "desc" ? "asc" : "desc" %>" 
          class="px-3 py-2 bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-sm flex items-center gap-2 cursor-pointer"
        >
          Modified
          <% if (query.sort == "createdAt" && query.order == "desc") { %>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
              <path d="M480-360 280-560h400L480-360Z"/>
            </svg>
          <% } else { %>
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
              <path d="m280-400 200-200 200 200H280Z"/>
            </svg>
          <% } %>
        </a>
        <% if (query.sort && query.order) { %>
        <a 
          href="/folder/<%= folder.id %>" 
          class="px-3 py-2 bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-sm flex items-center gap-2 cursor-pointer"
        >
          Clear
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
            <path d="M120-280v-80h560v80H120Zm80-160v-80h560v80H200Zm80-160v-80h560v80H280Z"/>
          </svg>
        </a>
        <% } %>
      </section>
      <hr class="mt-4 border-t-neutral-200 dark:border-t-neutral-600">
    </nav>

    <!-- MARK: Folders -->
    <h2 class="text-lg font-semibold mb-4">Folders</h2>
    <ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-4 mb-8">
      <% if (folders && folders.length > 0) { %> <% folders.forEach(folder => {
      %>
      <li
        class="relative bg-neutral-50 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded p-4"
        x-data="{ open: false }"
      >
        <div class="flex justify-between items-center">
          <span
            ><a
              href="/folder/<%= folder.id %>"
              class="hover:underline font-medium"
              ><%= folder.name %></a
            ></span
          >
          <button
            class="p-1 rounded hover:bg-gray-200 dark:hover:bg-neutral-600 focus:outline-none"
            @click="open = !open"
            aria-label="Folder options"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/></svg>
          </button>
        </div>

        <!-- MARK: Folder actions -->
        <div
          x-show="open"
          @click.away="open = false"
          x-transition
          class="absolute top-full right-0 mt-1 w-32 bg-white dark:bg-neutral-900 border border-neutral-100 dark:border-neutral-800 rounded z-10"
          x-cloak
        >
          <form
            action="/folder/<%= folder.id %>/rename"
            method="post"
            x-data="{ openRename: false }"
          >
            <div class="w-screen h-screen bg-neutral-950/30 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex items-center justify-center"
              x-show="openRename"
              x-transition
              x-transition.opacity
            >   
              <div class="z-auto w-xs p-4 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-md shadow-sm flex flex-col"
                @click.away="openRename = false"
              >
                <label class="mb-2 font-semibold" for="newName">
                  Rename
                </label>
                <input
                  type="text"
                  name="newName"
                  id="newName"
                  placeholder="Rename folder"
                  class="mb-4 p-2 bg-neutral-200 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 focus-visible:border-neutral-400 dark:focus-visible:border-neutral-600 focus-visible:ring-neutral-300 dark:focus-visible:ring-neutral-700 focus-visible:ring-[3px] rounded outline-none"
                  required
                  value="<%= folder.name %>"
                />
                <button
                  type="submit"
                  class="px-4 py-2 bg-primary-10 text-black rounded"
                >
                  Save
                </button>
              </div>
            </div>

            <button
              type="button"
              class="w-full block px-4 py-2 border-b border-neutral-200 dark:border-neutral-800 text-left cursor-pointer"
              @click="openRename = !openRename"
            >
              Rename
            </button>
          </form>

          <form
            action="/folder/<%= folder.id %>/delete"
            method="post"
            onsubmit="return confirm('Are you sure you want to delete this folder?');"
          >
            <button
              type="submit"
              class="w-full block px-4 py-2 text-left text-red-600 cursor-pointer"
            >
              Delete
            </button>
          </form>
        </div>
      </li>
      <% }) %> <% } else { %>
      <p class="text-neutral-500 dark:text-neutral-400 col-span-full">No subfolders available.</p>
      <% } %>
    </ul>

    <!-- MARK: Files -->
    <h2 class="text-lg font-semibold mb-4">Files</h2>
    <ul class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4 mb-8">
      <% if (files && files.length > 0) { %> <% files.forEach(file => { %>
      <li 
        class="p-4 bg-neutral-50 dark:bg-neutral-800 rounded border border-neutral-200 dark:border-neutral-700"
      >
        <div 
          class="relative flex items-center justify-between"
          x-data="{ open: false }"
        >
        <% if (["image/jpeg", "image/png", "image/jpg", "image/gif"].includes(file.type)) { %>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm40-80h480L570-480 450-320l-90-120-120 160Zm-40 80v-560 560Z"/>
          </svg>      
        <% } else { %>
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor">
            <path d="M320-440h320v-80H320v80Zm0 120h320v-80H320v80Zm0 120h200v-80H320v80ZM240-80q-33 0-56.5-23.5T160-160v-640q0-33 23.5-56.5T240-880h320l240 240v480q0 33-23.5 56.5T720-80H240Zm280-520v-200H240v640h480v-440H520ZM240-800v200-200 640-640Z"/>
          </svg>
        <% } %>
         
          <a href="/file/<%= file.id %>" class="hover:underline underline-offset-2 w-4/5 mx-2 truncate">
            <%= file.name %>
          </a>
          <button 
            class="p-1 rounded hover:bg-gray-200 dark:hover:bg-neutral-600 focus:outline-none"
            @click="open = !open"
            aria-label="Folder options"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-160q-33 0-56.5-23.5T400-240q0-33 23.5-56.5T480-320q33 0 56.5 23.5T560-240q0 33-23.5 56.5T480-160Zm0-240q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Zm0-240q-33 0-56.5-23.5T400-720q0-33 23.5-56.5T480-800q33 0 56.5 23.5T560-720q0 33-23.5 56.5T480-640Z"/></svg>
          </button>

          <!-- MARK: File actions -->
          <div
            x-show="open"
            @click.away="open = false"
            x-transition
            class="absolute top-full right-0 mt-1 w-32 bg-white dark:bg-neutral-900 border border-neutral-100 dark:border-neutral-800 rounded z-10"
            x-cloak
          >
            <form
              action="/file/<%= file.id %>/rename"
              method="post"
              x-data="{ openRename: false }"
            >
              <div class="w-screen h-screen bg-neutral-950/30 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex items-center justify-center"
                x-show="openRename"
                x-transition
              >   
                <div class="z-auto w-sm p-4 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-md shadow-sm flex flex-col"
                  @click.away="openRename = false"
                >
                  <label class="mb-2 font-semibold" for="newName">
                    Rename
                  </label>
                  <input
                    type="text"
                    name="newName"
                    id="newName"
                    placeholder="Rename file"
                    class="mb-4 p-2 bg-neutral-200 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 focus-visible:border-neutral-400 dark:focus-visible:border-neutral-600 focus-visible:ring-neutral-300 dark:focus-visible:ring-neutral-700 focus-visible:ring-[3px] rounded outline-none"
                    required
                    value="<%= file.name %>"
                  />
                  <button
                    type="submit"
                    class="px-4 py-2 bg-primary-10 text-black rounded"
                  >
                    Save
                  </button>
                </div>
              </div>

              <button
                type="button"
                class="w-full block px-4 py-2 border-b border-neutral-200 dark:border-neutral-800 text-left cursor-pointer"
                @click="openRename = !openRename"
              >
                Rename
              </button>
            </form>

            <form
              action="/file/<%= file.id %>/delete"
              method="post"
              onsubmit="return confirm('Are you sure you want to delete this file?');"
            >
              <button
                type="submit"
                class="w-full block px-4 py-2 text-left text-red-600 cursor-pointer"
              >
                Delete
              </button>
            </form>
          </div>
        </div>
      </li>
      <% }) %> <% } else { %>
      <p class="text-neutral-500 dark:text-neutral-400 col-span-full">No files available.</p>
      <% } %>
    </ul>

    <!-- MARK: Add button for mobile -->
     <section class="block lg:hidden fixed right-10 bottom-10 " x-data="{openDropdown: false, openCreateFolder: false}">
      <button class="bg-primary-0 w-min h-min rounded-full p-4 text-black shadow-2xl cursor-pointer" @click="openDropdown = !openDropdown">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M440-120v-320H120v-80h320v-320h80v320h320v80H520v320h-80Z"/></svg>
      </button>

        <div
          x-show="openDropdown"
          x-transition
          @click.away="openDropdown = false"
          class="absolute -top-20 -left-30 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 dark:text-white rounded-sm shadow-lg z-20 [&_button]:flex [&_button]:gap-2 [&_button]:px-4 [&_button]:py-3 [&_button]:cursor-pointer"
          x-cloak
        >
          <button
            @click="openCreateFolder = !openCreateFolder"
            title="Create Folder"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              />
            </svg>
            <span>New Folder</span>
          </button>

          <!-- MARK: Upload file button -->
          <button
            @click="$refs.fileInput.click()"
            title="Upload File"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <span>Upload File</span>
          </button>

          <div
            class="w-screen h-screen bg-neutral-950/30 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 flex items-center justify-center"
            x-show="openCreateFolder"
            x-cloak
            x-transition.opacity
          >
            <form 
              action="/folder/<%= folder.id %>/create" 
              method="post" 
              x-show="openCreateFolder"
              @click.away="openCreateFolder = false" 
              x-transition
              class="p-4 bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded shadow-lg"
            >
              <label for="folderName" class="block text-sm font-medium mb-2"
                >Folder Name:</label
              >
              <input
                type="text"
                name="folderName"
                id="folderName"
                class="w-full p-2 rounded mb-4 bg-neutral-800 text-gray-200"
                placeholder="Enter folder name"
                required
              />
              <div class="flex justify-end gap-2">
                <button
                  type="button"
                  @click="openCreateFolder = false"
                  class="px-4 py-2 rounded border border-neutral-800 font-semibold text-primary-0 cursor-pointer"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="px-4 py-2 rounded border border-neutral-800 font-semibold text-primary-0 cursor-pointer"
                >
                  Create
                </button>
              </div>
            </form>
          </div>
          
          <!-- MARK: Upload folder form -->
          <form
            action="/folder/<%= folder.id %>/upload"
            method="post"
            enctype="multipart/form-data"
            class="hidden"
          >
            <input
              type="file"
              name="file"
              x-ref="fileInput"
              class="hidden"
              @change="$el.form.submit()"
            />
          </form>
        </div>
     </section>
  </main>
</body>
<% } %>
</div>